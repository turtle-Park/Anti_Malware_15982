import os
from io import StringIO
from io import BytesIO

class Engine:

    def __init__(self, debug=False):
        self.debug = debug

        self.plugins_path = None
        self.Priority = []

    def set_plugins(self,plugins_path):
        self.plugins_path = plugins_path

        ret = self.__getPriority_list(plugins_path + os.sep + 'kicom.lst')
        if not ret:
            return False

        if self.debug:
            print('[*] kicom.list :')
            print('  ',self.Priority)

        return True

    def __getPriority_list(self, kicomPriorityfile):
        Priority = []
        try:
            fp = open(kicomPriorityfile,'rb')
            buf = fp.read()
            fp.close()

            msg = StringIO(buf)
            while True:
                line = msg.readline().strip()

                if not line:
                    break
                elif line.find('.lst') != -1:
                    Priority.append(line)
                else:
                    continue

        except:
            print("kicomPriorityfile open error")
            pass

        if len(Priority):
            self.Priority = Priority
            return True
        else:
            return False